import{C as x,r as f,B as q,l as I,c,o as i,a as n,u as o,m as N,w as d,b as p,d as j,e as A,h as E,F as y,j as V,t as F,P as L,f as M}from"./app-D8OPSLji.js";import{_ as O}from"./AuthenticatedLayout-DTlQNGiu.js";import{_ as b}from"./Button-D80aJfgU.js";import{_ as U}from"./Alert-132oDIUR.js";import{_ as D,a as P,b as Q,c as T,d as R}from"./BreakModal-oUFlHo5T.js";import"./Input-CpHXBpmC.js";import"./Card-BGvY5qee.js";const z={class:"max-w-7xl"},G={class:"list-disc list-inside"},H={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},J={class:"flex items-center justify-end space-x-4"},K={key:0},W={key:1},oe={__name:"Edit",props:{band:{type:Object,required:!0},setlist:{type:Object,required:!0},availableSongs:{type:Array,required:!0}},setup(v){const l=v,r=x({band_id:l.band.id,name:l.setlist.name,description:l.setlist.description,items:[],total_duration:l.setlist.total_duration}),u=f([...l.availableSongs]),s=f([]),_=f(!1);q(()=>{s.value=l.setlist.items.map(e=>({...e,id:e.type==="break"?`break-${e.id}`:e.song.id,name:e.type==="break"?e.title:e.song.name,pivot:{notes:e.notes,order:e.order}}))});const m=f(""),h=I(()=>{if(!m.value)return u.value;const e=m.value.toLowerCase();return u.value.filter(t=>t.name.toLowerCase().includes(e))}),g=()=>{r.total_duration=s.value.reduce((e,t)=>e+(t.duration_seconds||0),0)},k=e=>{s.value.push({id:`break-${Date.now()}`,...e,pivot:{notes:e.notes,order:s.value.length}}),g()},S=e=>{const t={...e,type:"song",pivot:{notes:"",order:s.value.length}};s.value.push(t);const a=u.value.findIndex(B=>B.id===e.id);a!==-1&&u.value.splice(a,1),g()},$=e=>{const t=s.value[e];if(t.type==="song"){const a={...t};delete a.pivot,u.value.push(a)}s.value.splice(e,1),g()},w=({index:e,notes:t})=>{s.value[e]&&(s.value[e].pivot.notes=t)},C=()=>{r.items=s.value.map(e=>{const t={type:e.type,duration_seconds:e.duration_seconds,notes:e.pivot.notes};return e.type==="song"?(t.song_id=e.id,t.title=null):(t.song_id=null,t.title=e.title||e.name),t}),r.put(route("setlists.update",[l.band.id,l.setlist.id]),{preserveScroll:!0,onError:e=>{console.error("Form errors:",e)}})};return(e,t)=>(i(),c(y,null,[n(o(N),{title:"Edit Setlist"}),n(O,null,{header:d(()=>[n(R,{band:v.band},null,8,["band"])]),default:d(()=>[p("div",z,[p("form",{onSubmit:j(C,["prevent"]),class:"space-y-6"},[Object.keys(o(r).errors).length>0?(i(),A(o(U),{key:0,type:"error"},{default:d(()=>[p("ul",G,[(i(!0),c(y,null,V(o(r).errors,a=>(i(),c("li",{key:a},F(a),1))),128))])]),_:1})):E("",!0),n(D,{form:o(r)},null,8,["form"]),p("div",H,[n(P,{songs:h.value,"search-query":m.value,"onUpdate:searchQuery":t[0]||(t[0]=a=>m.value=a),onAddSong:S},null,8,["songs","search-query"]),n(Q,{items:s.value,"onUpdate:items":t[1]||(t[1]=a=>s.value=a),"total-duration":o(r).total_duration,onRemove:$,onUpdateNotes:w,onAddBreak:t[2]||(t[2]=a=>_.value=!0)},null,8,["items","total-duration"])]),p("div",J,[n(o(L),{href:e.route("setlists.show",[v.band.id,v.setlist.id])},{default:d(()=>[n(o(b),{type:"button",variant:"outline"},{default:d(()=>t[4]||(t[4]=[M(" Cancel ")])),_:1})]),_:1},8,["href"]),n(o(b),{type:"submit",variant:"primary",disabled:o(r).processing||s.value.length===0},{default:d(()=>[o(r).processing?(i(),c("span",K,"Saving...")):(i(),c("span",W,"Save Changes"))]),_:1},8,["disabled"])])],32)]),n(T,{"is-open":_.value,onClose:t[3]||(t[3]=a=>_.value=!1),onCreate:k},null,8,["is-open"])]),_:1})],64))}};export{oe as default};
