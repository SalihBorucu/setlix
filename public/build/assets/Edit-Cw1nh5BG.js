import{C as q,r as f,q as B,x as I,c as p,o as l,a as i,u as a,m as N,w as d,b as m,d as j,e as A,h as E,F as y,j as V,t as F,P as L,f as M}from"./app-A2ZPFEA1.js";import{_ as O}from"./AuthenticatedLayout-pBuoNgCj.js";import{_ as b}from"./DSTooltip.vue_vue_type_style_index_0_lang-DZ7h0HcY.js";import{_ as U}from"./Alert-DQh4k2NX.js";import{_ as D,a as P,b as Q,c as T}from"./SetlistItemsList-ZHbAQerd.js";import{_ as R}from"./BreakModal-DF3aJj9a.js";/* empty css            */import"./Modal-CaDCvfAh.js";import"./transition--5CDJYK_.js";import"./Input-BefxLOKD.js";import"./Card-wPTLm-dJ.js";import"./DSDurationInput-wwZ2M_zH.js";const z={class:"max-w-7xl"},G={class:"list-disc list-inside"},H={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},J={class:"flex items-center justify-end space-x-4"},K={key:0},W={key:1},de={__name:"Edit",props:{band:{type:Object,required:!0},setlist:{type:Object,required:!0},availableSongs:{type:Array,required:!0}},setup(u){const n=u,r=q({band_id:n.band.id,name:n.setlist.name,description:n.setlist.description,target_duration:n.setlist.target_duration,target_duration_seconds:n.setlist.target_duration,items:[],total_duration:n.setlist.total_duration}),c=f([...n.availableSongs]),s=f([]),_=f(!1);B(()=>{s.value=n.setlist.items.map(e=>({...e,id:e.type==="break"?`break-${e.id}`:e.song.id,name:e.type==="break"?e.title:e.song.name,pivot:{notes:e.notes,order:e.order}}))});const v=f(""),h=I(()=>{if(!v.value)return c.value;const e=v.value.toLowerCase();return c.value.filter(t=>t.name.toLowerCase().includes(e))}),g=()=>{r.total_duration=s.value.reduce((e,t)=>e+(t.duration_seconds||0),0)},k=e=>{s.value.push({id:`break-${Date.now()}`,...e,pivot:{notes:e.notes,order:s.value.length}}),g()},S=e=>{const t={...e,type:"song",pivot:{notes:"",order:s.value.length}};s.value.push(t);const o=c.value.findIndex(x=>x.id===e.id);o!==-1&&c.value.splice(o,1),g()},$=e=>{const t=s.value[e];if(t.type==="song"){const o={...t};delete o.pivot,c.value.push(o)}s.value.splice(e,1),g()},w=({index:e,notes:t})=>{s.value[e]&&(s.value[e].pivot.notes=t)},C=()=>{r.items=s.value.map(e=>{const t={type:e.type,duration_seconds:e.duration_seconds,notes:e.pivot.notes};return e.type==="song"?(t.song_id=e.id,t.title=null):(t.song_id=null,t.title=e.title||e.name),t}),r.put(route("setlists.update",[n.band.id,n.setlist.id]),{preserveScroll:!0,onError:e=>{console.error("Form errors:",e)}})};return(e,t)=>(l(),p(y,null,[i(a(N),{title:"Edit Setlist"}),i(O,null,{header:d(()=>[i(T,{band:u.band,setlist:u.setlist,form:a(r)},null,8,["band","setlist","form"])]),default:d(()=>[m("div",z,[m("form",{onSubmit:j(C,["prevent"]),class:"space-y-6"},[Object.keys(a(r).errors).length>0?(l(),A(a(U),{key:0,type:"error"},{default:d(()=>[m("ul",G,[(l(!0),p(y,null,V(a(r).errors,o=>(l(),p("li",{key:o},F(o),1))),128))])]),_:1})):E("",!0),i(D,{form:a(r)},null,8,["form"]),m("div",H,[i(P,{songs:h.value,"search-query":v.value,"onUpdate:searchQuery":t[0]||(t[0]=o=>v.value=o),onAddSong:S},null,8,["songs","search-query"]),i(Q,{items:s.value,"onUpdate:items":t[1]||(t[1]=o=>s.value=o),"total-duration":a(r).total_duration,onRemove:$,onUpdateNotes:w,onAddBreak:t[2]||(t[2]=o=>_.value=!0)},null,8,["items","total-duration"])]),m("div",J,[i(a(L),{href:e.route("setlists.show",[u.band.id,u.setlist.id])},{default:d(()=>[i(a(b),{type:"button",variant:"outline"},{default:d(()=>t[4]||(t[4]=[M(" Cancel ")])),_:1})]),_:1},8,["href"]),i(a(b),{type:"submit",variant:"primary",disabled:a(r).processing||s.value.length===0},{default:d(()=>[a(r).processing?(l(),p("span",K,"Saving...")):(l(),p("span",W,"Save Changes"))]),_:1},8,["disabled"])])],32)]),i(R,{"is-open":_.value,onClose:t[3]||(t[3]=o=>_.value=!1),onCreate:k},null,8,["is-open"])]),_:1})],64))}};export{de as default};
